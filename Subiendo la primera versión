<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Juego de Matematicas</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom styles for the game */
        body {
            font-family: ui-sans-serif, system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji"; /* Modern system font stack */
            line-height: 1.6;
            color: #333;
            background-color: #e0f7fa; /* Warm, light cyan-blue background */
            padding: 20px;
            display: flex; /* Use flexbox to center content */
            justify-content: center;
            align-items: center;
            min-height: 100vh; /* Minimum height of the viewport */
            box-sizing: border-box; /* Include padding in element's total width and height */
        }
        .container {
            background-color: #ffffff; /* White background */
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.08); /* Subtler shadow */
            text-align: center; /* Center text inside the container */
            max-width: 500px; /* Increased max width */
            width: 100%; /* Full width up to max-width */
            box-sizing: border-box;
        }

        /* Styles for the Welcome Screen */
        .welcome-screen {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .welcome-screen h1 {
             color: #1a202c;
            margin-bottom: 20px;
            font-size: 1.8em;
            font-weight: 700;
        }
        .welcome-screen input[type="text"] {
            padding: 10px;
            margin-bottom: 15px;
            border: 1px solid #cbd5e0;
            border-radius: 4px;
            font-size: 1.2em;
            width: 80%; /* Responsive width */
            max-width: 250px; /* Max width for input */
            text-align: center;
            box-sizing: border-box;
        }
         .welcome-screen button {
            background-color: #48bb78; /* Green button for start */
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 1.2em;
            transition: background-color 0.3s ease;
        }
        .welcome-screen button:hover {
            background-color: #38a169; /* Darker green on hover */
        }


        /* Styles for the Game Screen */
        .game-screen {
            display: none; /* Hidden by default */
            flex-direction: column;
            align-items: center;
        }
        .player-name {
            font-size: 1.1em;
            color: #4a5568;
            margin-bottom: 15px;
            font-weight: 600;
        }
        .level-info {
            font-size: 1em;
            color: #4a5568;
            margin-bottom: 15px;
        }
        .problem {
            font-size: 2.2em; /* Larger font size for the math problem */
            margin-bottom: 20px;
            color: #2d3748;
            min-height: 1.5em; /* Reserve space */
            display: flex;
            justify-content: center;
            align-items: center;
            flex-wrap: wrap; /* Allow problem to wrap on smaller screens */
        }
         .problem span {
             margin: 0 5px; /* Space between numbers and operators */
         }
        .input-area {
            margin-bottom: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-wrap: wrap; /* Allow input area to wrap */
        }
        input[type="number"] {
            padding: 10px;
            margin: 5px; /* Adjusted margin for flex wrap */
            border: 1px solid #cbd5e0; /* Light grey border */
            border-radius: 4px;
            font-size: 1.2em;
            width: 100px; /* Increased width for input */
            text-align: center;
            box-sizing: border-box;
        }
        button {
            background-color: #4299e1; /* Moderate blue button */
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 1.2em;
            transition: background-color 0.3s ease; /* Smooth hover effect */
            margin: 5px; /* Adjusted margin for flex wrap */
        }
        button:hover {
            background-color: #3182ce; /* Darker blue on hover */
        }
        .result {
            font-size: 1.4em;
            font-weight: 600;
            margin-top: 20px;
            min-height: 1.4em; /* Reserve space to prevent layout shift */
        }
        .result.correct {
            color: #38a169; /* Green for correct */
        }
        .result.incorrect {
            color: #e53e3e; /* Red for incorrect */
        }
         .result.level-up {
             color: #d69e2e; /* Orange color for level up messages */
         }
    </style>
</head>
<body>

    <div class="container">

        <div class="welcome-screen" id="welcome-screen">
            <h1>Bienvenido al Juego de Matemáticas</h1>
            <p>Ingresa tu nombre para empezar:</p>
            <input type="text" id="player-name-input" placeholder="Tu nombre">
            <button onclick="startGame()">Empezar Juego</button>
        </div>

        <div class="game-screen" id="game-screen">
            <div class="player-name">Jugador: <span id="display-player-name"></span></div>
            <div class="level-info">Nivel: <span id="current-level">1</span> | Correctas en este nivel: <span id="correct-streak">0</span>/5</div>

            <div class="problem" id="math-problem"></div>

            <div class="input-area">
                <input type="number" id="user-answer" placeholder="Tu respuesta">
                <button onclick="checkAnswer()">Verificar</button>
            </div>

            <div class="result" id="game-result"></div>
        </div>

    </div>

    <script>
        let playerName = '';
        let currentLevel = 1;
        let correctStreak = 0;
        let correctAnswer;
        const maxLevel = 20; // Set max level to 20
        const correctPerLevel = 5; // Answers needed to level up

        // Array of congratulatory messages, increasing in enthusiasm
        const congratulations = [
            "¡Bien hecho! ¡Nivel {level} desbloqueado!", // Level 2
            "¡Excelente! ¡Pasaste al Nivel {level}!", // Level 3
            "¡Fantástico, {name}! ¡Ya estás en el Nivel {level}!", // Level 4
            "¡Increíble! ¡El Nivel {level} te espera!", // Level 5
            "¡Wow! ¡Eres imparable! ¡Nivel {level} alcanzado!", // Level 6-10
            "¡Asombroso, {name}! ¡Dominando las matemáticas en el Nivel {level}!", // Level 11-15
            "¡Fuera de serie! ¡El Nivel {level} no es rival para ti!", // Level 16-19
            "¡¡¡IMPRESIONANTE, {name}!!! ¡Has llegado al ÚLTIMO Nivel {level}! ¡Demuestra de qué estás hecho!" // Level 20
        ];

        // Function to get a congratulatory message based on the level
        function getCongratulationMessage(level, name) {
            let message;
            if (level === 2) message = congratulations[0];
            else if (level === 3) message = congratulations[1];
            else if (level === 4) message = congratulations[2];
            else if (level === 5) message = congratulations[3];
            else if (level >= 6 && level <= 10) message = congratulations[4];
            else if (level >= 11 && level <= 15) message = congratulations[5];
            else if (level >= 16 && level <= 19) message = congratulations[6];
            else if (level === 20) message = congratulations[7];
            else message = `¡Nivel ${level} desbloqueado!`; // Fallback message

            // Replace placeholders
            message = message.replace("{level}", level).replace("{name}", name);
            return message;
        }


        // Function to start the game
        function startGame() {
            const nameInput = document.getElementById('player-name-input');
            playerName = nameInput.value.trim(); // Get player name and remove whitespace

            if (playerName === '') {
                alert('Por favor, ingresa tu nombre para empezar.'); // Simple alert if name is empty
                return; // Don't start the game if name is empty
            }

            // Display player name
            document.getElementById('display-player-name').textContent = playerName;

            // Hide welcome screen and show game screen
            document.getElementById('welcome-screen').style.display = 'none';
            document.getElementById('game-screen').style.display = 'flex'; // Use flex to maintain layout

            // Generate the first problem
            generateProblem();
        }


        // Function to generate a random integer within a range
        function getRandomInt(min, max) {
            return Math.floor(Math.random() * (max - min + 1)) + min;
        }

        // Helper function to evaluate a simple expression string (e.g., "5 + 3 * 2")
        // WARNING: This is a very basic evaluator and does NOT handle operator precedence correctly.
        // For complex expressions, a proper parser/evaluator is needed.
        // For this game, we will rely on generating expressions with parentheses to control order.
        function evaluateExpression(expression) {
            try {
                 // Use the built-in eval function cautiously. It's powerful but can be a security risk
                 // if the expression comes from an untrusted source. Here, we generate the expression,
                 // so it's relatively safe for this specific game context.
                return eval(expression);
            } catch (error) {
                console.error("Error evaluating expression:", expression, error);
                return NaN; // Return Not-a-Number on error
            }
        }


        // Function to generate a math problem based on the current level
        function generateProblem() {
            let problemString;
            let requiresIntegerResult = currentLevel <= 10; // Require integer results up to level 10

            // Determine complexity based on level (scaled for 20 levels)
            if (currentLevel <= 3) {
                // Level 1-3: Suma o Resta (números pequeños)
                let num1 = getRandomInt(1, 15);
                let num2 = getRandomInt(1, 15);
                let operator1 = Math.random() < 0.5 ? '+' : '-';
                if (operator1 === '-' && num1 < num2) { // Ensure positive result for subtraction
                    [num1, num2] = [num2, num1]; // Swap
                }
                problemString = `${num1} ${operator1} ${num2}`;

            } else if (currentLevel <= 6) {
                // Level 4-6: Suma, Resta, Multiplicación (números hasta 20)
                let num1 = getRandomInt(1, 20);
                let num2 = getRandomInt(1, 20);
                const operators = ['+', '-', '*'];
                let operator1 = operators[getRandomInt(0, 2)];
                 if (operator1 === '-' && num1 < num2) { // Ensure positive result for subtraction
                    [num1, num2] = [num2, num1]; // Swap
                }
                problemString = `${num1} ${operator1} ${num2}`;

            } else if (currentLevel <= 9) {
                // Level 7-9: Suma, Resta, Multiplicación, División (resultados enteros garantizados, números hasta 25)
                let num1 = getRandomInt(1, 25);
                let num2 = getRandomInt(1, 25);
                 const operators = ['+', '-', '*', '/'];
                let operator1 = operators[getRandomInt(0, 3)];

                if (operator1 === '-') { // Ensure positive result for subtraction
                    if (num1 < num2) [num1, num2] = [num2, num1];
                } else if (operator1 === '/') { // Ensure integer result for division
                    // Find a divisor for num1
                    let divisors = [];
                    for (let i = 1; i <= num1; i++) {
                        if (num1 % i === 0) {
                            divisors.push(i);
                        }
                    }
                     if (divisors.length > 0) {
                         num2 = divisors[getRandomInt(0, divisors.length - 1)];
                     } else {
                         num2 = 1; // Fallback if num1 is 1
                     }
                    if (num2 === 0) num2 = 1; // Avoid division by zero
                }

                problemString = `${num1} ${operator1} ${num2}`;


            } else if (currentLevel <= 12) {
                 // Level 10-12: Mezcla de las 4 operaciones básicas, números hasta 30, simple dos-pasos con paréntesis
                 let num1 = getRandomInt(1, 30);
                 let num2 = getRandomInt(1, 30);
                 let num3 = getRandomInt(1, 30);
                 const operators = ['+', '-', '*', '/'];
                 let operator1 = operators[getRandomInt(0, 3)];
                 let operator2 = operators[getRandomInt(0, 3)];
                 requiresIntegerResult = currentLevel <= 10; // Allow decimals from level 11

                 // Structure: (a op b) op c or a op (b op c)
                 if (Math.random() < 0.5) { // (a op b) op c
                     // Ensure valid intermediate step for integer results
                     if (requiresIntegerResult) {
                         if (operator1 === '-') { if (num1 < num2) [num1, num2] = [num2, num1]; }
                         if (operator1 === '/') {
                             let divisors = [];
                             for (let i = 1; i <= num1; i++) { if (num1 % i === 0) divisors.push(i); }
                              if (divisors.length > 0) { num2 = divisors[getRandomInt(0, divisors.length - 1)]; } else { num2 = 1; }
                             if (num2 === 0) num2 = 1;
                         }
                     } else { // Allow decimals, just avoid division by zero
                          if (operator1 === '/' && num2 === 0) num2 = 1;
                     }

                     let intermediateResult = evaluateExpression(`${num1} ${operator1} ${num2}`);

                     // Ensure valid final step for integer results
                     if (requiresIntegerResult) {
                         if (operator2 === '-') { if (intermediateResult < num3) [intermediateResult, num3] = [num3, intermediateResult]; }
                         if (operator2 === '/') {
                             let divisors = [];
                             for (let i = 1; i <= intermediateResult; i++) { if (intermediateResult % i === 0) divisors.push(i); }
                              if (divisors.length > 0) { num3 = divisors[getRandomInt(0, divisors.length - 1)]; } else { num3 = 1; }
                             if (num3 === 0) num3 = 1;
                         }
                     } else { // Allow decimals, just avoid division by zero
                          if (operator2 === '/' && num3 === 0) num3 = 1;
                     }

                     problemString = `(${num1} ${operator1} ${num2}) ${operator2} ${num3}`;

                 } else { // a op (b op c)
                     // Ensure valid intermediate step for integer results
                     if (requiresIntegerResult) {
                         if (operator2 === '-') { if (num2 < num3) [num2, num3] = [num3, num3]; }
                         if (operator2 === '/') {
                             let divisors = [];
                             for (let i = 1; i <= num2; i++) { if (num2 % i === 0) divisors.push(i); }
                              if (divisors.length > 0) { num3 = divisors[getRandomInt(0, divisors.length - 1)]; } else { num3 = 1; }
                             if (num3 === 0) num3 = 1;
                         }
                     } else { // Allow decimals, just avoid division by zero
                          if (operator2 === '/' && num3 === 0) num3 = 1;
                     }

                     let intermediateResult = evaluateExpression(`${num2} ${operator2} ${num3}`);

                     // Ensure valid final step for integer results
                     if (requiresIntegerResult) {
                         if (operator1 === '-') { if (num1 < intermediateResult) [num1, intermediateResult] = [intermediateResult, num1]; }
                         if (operator1 === '/') {
                              // This is complex to guarantee integer division for the final step easily.
                              // For integer results, we might need to regenerate or ensure num1 is a multiple of intermediateResult.
                              // Let's regenerate for simplicity if the result is not an integer and required.
                         }
                     } else { // Allow decimals, just avoid division by zero
                          if (operator1 === '/' && intermediateResult === 0) intermediateResult = 1;
                     }

                     problemString = `${num1} ${operator1} (${num2} ${operator2} ${num3})`;
                 }

            } else if (currentLevel <= 15) {
                 // Level 13-15: Increase number range (up to 50), more complex two-step or simple three-step, exponents
                 let num1 = getRandomInt(1, 50);
                 let num2 = getRandomInt(1, 50);
                 let num3 = getRandomInt(1, 50);
                 let num4 = getRandomInt(1, 50);
                 const operators = ['+', '-', '*', '/'];
                 let operator1 = operators[getRandomInt(0, 3)];
                 let operator2 = operators[getRandomInt(0, 3)];
                 let operator3 = operators[getRandomInt(0, 3)];
                 requiresIntegerResult = false; // Allow decimals

                 // Structures: ((a op b) op c) op d or (a op b) op (c op d) or with exponents
                 if (Math.random() < 0.6) { // Nested structure
                     // Ensure valid intermediate steps (avoid division by zero)
                     if (operator1 === '/' && num2 === 0) num2 = 1;
                     let intermediate1 = evaluateExpression(`${num1} ${operator1} ${num2}`);

                     if (operator2 === '/' && num3 === 0) num3 = 1;
                     let intermediate2 = evaluateExpression(`${intermediate1} ${operator2} ${num3}`);

                     if (operator3 === '/' && num4 === 0) num4 = 1;


                     problemString = `((${num1} ${operator1} ${num2}) ${operator2} ${num3}) ${operator3} ${num4}`;

                 } else if (Math.random() < 0.8) { // Two parenthesized groups
                      if (operator1 === '/' && num2 === 0) num2 = 1;
                     let intermediate1 = evaluateExpression(`${num1} ${operator1} ${num2}`);

                     if (operator3 === '/' && num4 === 0) num4 = 1;
                     let intermediate2 = evaluateExpression(`${num3} ${operator3} ${num4}`);

                     operator2 = operators[getRandomInt(0, 3)]; // Operator between groups
                     if (operator2 === '/' && intermediate2 === 0) intermediate2 = 1;

                     problemString = `(${num1} ${operator1} ${num2}) ${operator2} (${num3} ${operator3} ${num4})`;

                 } else { // Expression with exponents
                     let base1 = getRandomInt(1, 10);
                     let exp1 = getRandomInt(2, 3);
                     let base2 = getRandomInt(1, 10);
                     let exp2 = getRandomInt(2, 3);
                     operator1 = operators[getRandomInt(0, 3)];
                     operator2 = operators[getRandomInt(0, 3)];
                      let num = getRandomInt(1, 50);

                     // Structure: base1^exp1 op base2^exp2 op num
                     let power1 = Math.pow(base1, exp1);
                     let power2 = Math.pow(base2, exp2);

                     if (operator1 === '/' && power2 === 0) power2 = 1;
                     let intermediate = evaluateExpression(`${power1} ${operator1} ${power2}`);

                     if (operator2 === '/' && num === 0) num = 1;

                     problemString = `${base1}^${exp1} ${operator1} ${base2}^${exp2} ${operator2} ${num}`;
                 }


            } else if (currentLevel <= 20) {
                // Level 16-20: Very complex expressions ("genius" level arithmetic)
                 let num1 = getRandomInt(1, 100);
                 let num2 = getRandomInt(1, 100);
                 let num3 = getRandomInt(1, 100);
                 let num4 = getRandomInt(1, 100);
                 let num5 = getRandomInt(1, 100);
                 const operators = ['+', '-', '*', '/'];
                 let operator1 = operators[getRandomInt(0, 3)];
                 let operator2 = operators[getRandomInt(0, 3)];
                 let operator3 = operators[getRandomInt(0, 3)];
                 let operator4 = operators[getRandomInt(0, 3)];
                 requiresIntegerResult = false; // Allow decimals

                 // Very complex nested structures or expressions with multiple terms and exponents
                 if (Math.random() < 0.5) { // (((a op b) op c) op d) op e
                      // Ensure no division by zero at any step
                     if (operator1 === '/' && num2 === 0) num2 = 1;
                     let intermediate1 = evaluateExpression(`${num1} ${operator1} ${num2}`);

                     if (operator2 === '/' && num3 === 0) num3 = 1;
                     let intermediate2 = evaluateExpression(`${intermediate1} ${operator2} ${num3}`);

                     if (operator3 === '/' && num4 === 0) num4 = 1;
                     let intermediate3 = evaluateExpression(`${intermediate2} ${operator3} ${num4}`);

                     if (operator4 === '/' && num5 === 0) num5 = 1;

                     problemString = `(((${num1} ${operator1} ${num2}) ${operator2} ${num3}) ${operator3} ${num4}) ${operator4} ${num5}`;

                 } else if (Math.random() < 0.8) { // (a op (b op c)) op (d op e)
                     if (operator2 === '/' && num3 === 0) num3 = 1;
                     let intermediate1 = evaluateExpression(`${num2} ${operator2} ${num3}`);

                     if (operator1 === '/' && intermediate1 === 0) intermediate1 = 1;
                     let intermediate2 = evaluateExpression(`${num1} ${operator1} ${intermediate1}`);

                     if (operator4 === '/' && num5 === 0) num5 = 1;
                     let intermediate3 = evaluateExpression(`${num4} ${operator4} ${num5}`);

                     operator3 = operators[getRandomInt(0, 3)]; // Operator between groups
                     if (operator3 === '/' && intermediate3 === 0) intermediate3 = 1;

                     problemString = `(${num1} ${operator1} (${num2} ${operator2} ${num3})) ${operator3} (${num4} ${operator4} ${num5})`;

                 } else { // Expression with multiple exponents and operations
                     let base1 = getRandomInt(1, 10); let exp1 = getRandomInt(2, 3);
                     let base2 = getRandomInt(1, 10); let exp2 = getRandomInt(2, 3);
                     let base3 = getRandomInt(1, 10); let exp3 = getRandomInt(2, 3);
                     operator1 = operators[getRandomInt(0, 3)];
                     operator2 = operators[getRandomInt(0, 3)];
                     operator3 = operators[getRandomInt(0, 3)];

                     let power1 = Math.pow(base1, exp1);
                     let power2 = Math.pow(base2, exp2);
                     let power3 = Math.pow(base3, exp3);

                     // Structure: (power1 op power2) op power3
                     if (operator1 === '/' && power2 === 0) power2 = 1;
                     let intermediate = evaluateExpression(`${power1} ${operator1} ${power2}`);

                     if (operator2 === '/' && power3 === 0) power3 = 1;

                     problemString = `(${base1}^${exp1} ${operator1} ${base2}^${exp2}) ${operator2} ${base3}^${exp3}`;
                 }


            } else {
                // Max level reached
                problemString = `¡Felicidades, ${playerName}! Has completado todos los niveles.`;
                correctAnswer = null; // No more answers to check
                document.getElementById('user-answer').style.display = 'none';
                document.querySelector('.input-area button').style.display = 'none';
                 document.getElementById('level-info').style.display = 'none'; // Hide level info
                 document.getElementById('game-result').className = 'result correct'; // Make final message green
            }

             // Calculate the correct answer using the evaluator
            if (correctAnswer !== null) {
                 correctAnswer = evaluateExpression(problemString);

                 // If integer result is required but the answer is a decimal, regenerate
                 if (requiresIntegerResult && correctAnswer !== Math.floor(correctAnswer)) {
                     generateProblem(); // Try generating again
                     return; // Exit current call
                 }

                 // Round decimal answers to a few decimal places for comparison
                 if (!requiresIntegerResult && correctAnswer !== null && typeof correctAnswer === 'number') {
                     correctAnswer = parseFloat(correctAnswer.toFixed(3)); // Round to 3 decimal places
                 }
            }


            // Display the problem
            document.getElementById('math-problem').textContent = problemString + (correctAnswer !== null ? ' = ?' : '');


            // Clear previous result and input
            document.getElementById('user-answer').value = '';
            document.getElementById('game-result').textContent = '';
            document.getElementById('game-result').className = 'result'; // Reset result classes

            // Update level info display
            document.getElementById('current-level').textContent = currentLevel;
            document.getElementById('correct-streak').textContent = correctStreak;
        }

        // Function to check the user's answer
        function checkAnswer() {
            // If max level reached, do nothing
            if (correctAnswer === null) return;

            const userAnswer = parseFloat(document.getElementById('user-answer').value); // Use parseFloat for decimals
            const resultElement = document.getElementById('game-result');

            // Check if the input is a valid number
            if (isNaN(userAnswer)) {
                resultElement.textContent = 'Por favor, ingresa un número válido.';
                resultElement.className = 'result incorrect';
                correctStreak = 0; // Reset streak on incorrect/invalid answer
                 document.getElementById('correct-streak').textContent = correctStreak;
                return; // Exit the function
            }

            // Compare user's answer with the correct answer (allow for small floating point differences)
            const tolerance = 0.001; // Tolerance for floating point comparisons
            if (Math.abs(userAnswer - correctAnswer) < tolerance) {
                resultElement.textContent = '¡Correcto!';
                resultElement.className = 'result correct';
                correctStreak++; // Increase streak

                // Check if level should increase
                if (correctStreak >= correctPerLevel && currentLevel < maxLevel) {
                    // Level Up!
                    correctStreak = 0; // Reset streak
                    currentLevel++; // Increase level

                    // Get and display congratulatory message
                    const congratsMessage = getCongratulationMessage(currentLevel, playerName);
                    resultElement.textContent = congratsMessage;
                    resultElement.className = 'result level-up'; // Apply level-up style

                    // Generate a new problem after a short delay (longer for level up message)
                    setTimeout(generateProblem, 2500); // Wait 2.5 seconds for level up message

                } else if (correctStreak >= correctPerLevel && currentLevel === maxLevel) {
                     // Player completed the last level streak
                     correctStreak++; // Increment one last time to show 5/5
                      // The next problem generation will handle the max level message
                      resultElement.textContent = '¡Correcto!'; // Show correct for the last problem
                      resultElement.className = 'result correct';
                      setTimeout(generateProblem, 1500); // Short delay before final message

                } else {
                    // Correct answer, but not enough for level up yet
                    setTimeout(generateProblem, 1500); // Wait 1.5 seconds before new problem
                }


            } else {
                resultElement.textContent = 'Incorrecto. Intenta de nuevo.';
                resultElement.className = 'result incorrect';
                correctStreak = 0; // Reset streak on incorrect answer
                 // Update streak display immediately on incorrect answer
                document.getElementById('correct-streak').textContent = correctStreak;
            }

             // Update level info display after checking answer (except when leveling up, it updates after timeout)
             if (!(correctStreak === 0 && currentLevel < maxLevel && Math.abs(userAnswer - correctAnswer) < tolerance)) {
                document.getElementById('current-level').textContent = currentLevel;
                document.getElementById('correct-streak').textContent = correctStreak;
             }
        }

        // Initial state: Show welcome screen
        document.getElementById('welcome-screen').style.display = 'flex';
        document.getElementById('game-screen').style.display = 'none';


    </script>

</body>
</html>
